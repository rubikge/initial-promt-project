from logger import setup_logger
from openrouter.client import OpenRouter
import os
from dotenv import load_dotenv
from openrouter.models import ModelConfig
import logging

def main():
    # Set up logger with DEBUG level
    logger = setup_logger(level=logging.DEBUG)
    
    logger.info("Starting post-writer-backend application")
    load_dotenv()
    
    # Initialize OpenRouter client
    api_key = os.getenv("OPENROUTER_API_KEY")
    if not api_key:
        logger.error("OPENROUTER_API_KEY environment variable is not set")
        return
        
    openrouter = OpenRouter(api_key=api_key)
    
    # Example usage
    try:
        prompt_present = """Вы — эксперт-географ с талантом создавать увлекательные и информативные описания мест.

Ваша задача — проанализировать географическое местоположение и составить описательную справку в разговорном стиле. Результат должен выделять несколько ключевых фактов и строго соответствовать структуре и тону приведённого примера.

---
### ПРИМЕР

**Место на карте:**
*   Широта: 40.416667
*   Долгота: 45.2

**Правильный результат:**
Эти координаты указывают на **город Гавар** в Армении.

Вот более подробная информация об этом месте:
*   **Город:** **Гавар (арм. Գավառ)**. Это административный центр Гегаркуникской области Армении.
*   **Расположение:** Город расположен на западном берегу **озера Севан**, крупнейшего озера на Кавказе. Координаты указывают на юго-восточную часть города, недалеко от побережья.
*   **Озеро Севан:** Это главная природная достопримечательность региона. Севан — высокогорное пресное озеро, имеющее огромное значение для Армении, как экономическое, так и рекреационное. Его часто называют «Жемчужиной Армении» или «Армянским морем».
*   **Окрестности:** Местность представляет собой сочетание городской застройки, полей и горного ландшафта, характерного для этого региона Армении.

Короче говоря, эти координаты ведут вас в город Гавар, столицу Гегаркуникской области Армении, на живописном берегу озера Севан.

---
### ВАШЕ ЗАДАНИЕ

**Входные координаты:**
*   Широта: 46.539
*   Долгота: 43.699

**Инструкции:**
1.  Проанализируйте координаты.
2.  Сгенерируйте ответ, который в точности соответствует стилю, тону и формату **Правильного результата** из примера выше.
3.  Начните с прямого обобщающего предложения.
4.  Представьте 3-4 ключевых факта в виде маркированного списка.
5.  Используйте жирное выделение в markdown (`**текст**`) для важных имён собственных (названий мест, географических объектов).
6.  Обязательно укажите ближайший крупный город к указанным координатам.
7.  Закончите итоговым, завершающим предложением.
        """

        prompt_past = """Вы — эксперт по исторической географии и археологии, способный оживить прошлое любого места на Земле.
Ваша задача — на основе географических координат и заданного временного периода составить увлекательную и краткую историческую справку. Вы должны описать, что находилось на этом месте в указанную эпоху, какие люди там жили и чем они занимались, представив ровно 5 ключевых фактов.
ПРИМЕР
Входные данные:
Широта: 40.35
Долгота: 45.12
Временной период: 1196-932 гг. до н.э.
Правильный результат:
Это очень точный и интересный временной интервал! Он относится к периоду позднего бронзового и раннего железного века. В это время на месте современного города Гавар в Армении находился важный центр одной из культур Армянского нагорья.
Вот 5 интересных фактов о том, что представляло собой это место в 1196-932 гг. до н.э.:
Мощная циклопическая крепость: На этом месте стояла крепость, известная как "Ошаберд" ("Змеиная крепость"). Её стены были сложены из гигантских базальтовых валунов без раствора и служили административным и военным центром для местного вождя.
Центр развитой культуры: Регион был сердцем Лчашен-Мецаморской археологической культуры. Она известна своей развитой металлургией и богатыми погребениями, в которых находят даже древние боевые колесницы.
Искусные металлурги: Местные мастера были экспертами в обработке бронзы, создавая великолепное оружие и украшения. Именно в этот период здесь начало появляться железо — редкий и очень ценный металл.
Часть "страны Наири": В ассирийских источниках эти земли назывались "страной Наири" — конфедерацией десятков мелких княжеств, которые то воевали друг с другом, то объединялись против общего врага. Крепость в Гаваре была столицей одного из таких княжеств.
Предшественники Урарту: Эти протогосударственные образования и их культура стали фундаментом, на котором всего через несколько десятилетий возникло могущественное царство Урарту, объединившее всё Армянское нагорье.
Таким образом, в указанный период на месте современного Гавара находился укрепленный центр влиятельного княжества — очаг развитой культуры и будущей великой цивилизации.
ВАШЕ ЗАДАНИЕ
Входные данные:
Широта: 41.8922
Долгота: 12.4853
Временной период: 900-750 гг. до н.э.
Инструкции:
Проанализируйте координаты и временной период.
Сгенерируйте ответ, который в точности соответствует стилю, тону и формату Правильного результата из примера выше.
Начните с прямого обобщающего предложения, характеризующего эпоху для этого места.
Представьте ровно 5 ключевых исторических фактов в виде маркированного списка.
Используйте жирное выделение (**текст**) для важных имён, названий и терминов (названия культур, народов, мест).
Закончите итоговым, завершающим предложением."""
        
        prompt_new = """что находится в этих координатах 39.2 46.4"""
        
        response = openrouter.get_completion(
            prompt=prompt_new,
            model_config=ModelConfig(
                name="google/gemini-2.5-pro-preview",
                temperature=1,
                max_tokens=10000,
            )
        )
        logger.info(f"OpenRouter response: {response}")
    except Exception as e:
        logger.error(f"Error using OpenRouter: {str(e)}")
    
    logger.info("Application started successfully")

if __name__ == "__main__":
    main()
